<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>JSON Parsing</title>
  <link href="https://fonts.googleapis.com/css?family=Montserrat:500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./w3.css">

  <style>
    .thumb {
      height: 75px;
      border: 1px solid #000;
      margin: 10px 5px 0 0;
    }

    table {
      border: 1;
    }
  </style>
</head>

<body>

  <div class="w3-center">
    <h1>Where's My Prof?</h1>
  </div>

  <div id="searchArea" class="w3-container w3-white w3-padding-16 myLink">
    <div class="w3-third w3-padding">
      <select id="myselect" class="w3-select">
        <option value="">Department:</option>
        <option value='mathcs'>Math / Computer Science</option>
        <option value='music'>Music</option>
        <option value='physics'>Physics</option>
        <option value='anthropology'>Anthropology</option>
      </select>
    </div>

    <div class="w3-third w3-padding">
      <input type="text" class="w3-input w3-border" placeholder="Who's your prof?">
    </div>
    <div class="w3-third w3-padding">
      <input type="button" class="w3-button w3-gray" id="goButton" name="goButton" value="Find My Prof?" onclick="change_myselect(); toggle_visibility('classSearch');">
    </div>
  </div>

  <div id="classSearch" class="w3-myLink w3-center">
    <a href="#">Click here to search by class instead</a>
  </div>

  <div class="w3-container w3-center w3-padding">
    <p id="demo" class="w3-center"></p>
  </div>



  <script>
    /** Not going to lie, this is a pretty hacky implementation, but it works. A better implementation would probably use JQuery. */
    function readJsonFile(file, callback) {
      var rawFile = new XMLHttpRequest();
      rawFile.responseType = 'json'
      rawFile.overrideMimeType("application/json");
      rawFile.open("GET", file, true);
      rawFile.onreadystatechange = function() {
        if (rawFile.readyState === 4 && rawFile.status == "200") {
          callback(rawFile.response);
        }
      }
      rawFile.send(null);
    }

    function change_myselect() {
      var dbParam, data, x, txt = "";
      sel = document.getElementById("myselect").value;
      data = window.jsondata;
      depts = Object.keys(data.department);
      console.log(depts);
      console.log(sel);
      txt += "<table class=\"w3-table\">";
      if (sel === "") {
        console.log('Here');
        for (const y of depts) {
          console.log(y);
          for (x in data.department[y]) {
            console.log(x);
            txt += "<tr><td>" + y.toUpperCase() + "</td>";
            txt += "<td>" + data.department[y][x].name + "</td>";
            txt += "<td>" + data.department[y][x].email + "</td>";
            txt += "<td>" + data.department[y][x].phone + "</td>";
            txt += "<td>" + data.department[y][x].office.building + ' ' + data.department[y][x].office.room + "</td></tr>";
          }
        }
      } else {
        for (x in data.department[sel]) {
          txt += "<tr><td>" + data.department[sel][x].name + "</td>";
          txt += "<td>" + data.department[sel][x].email + "</td>";
          txt += "<td>" + data.department[sel][x].phone + "</td>";
          txt += "<td>" + data.department[sel][x].office.building + ' ' + data.department[sel][x].office.room + "</td></tr>";
        }
      }
      txt += "</table>";
      document.getElementById("demo").innerHTML = txt;
    }

    readJsonFile("professors.json", function(data) {
      window.jsondata = data;
      console.log(data);
    });

    function toggle_visibility(id) {
      var e = document.getElementById(id);
      e.style.display = 'none';
    }
  </script>

</body>

</html>
