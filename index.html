<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Where's My Prof?</title>
  <link href="https://fonts.googleapis.com/css?family=Montserrat:500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./w3.css">

  <style>
    .thumb {
      height: 75px;
      border: 1px solid #000;
      margin: 10px 5px 0 0;
    }

    table {
      border: 1;
    }
  </style>
</head>

<body class="w3-deep-purple">

  <div class="w3-center">
    <h1 class="w3-text-white">Where's My Prof?</h1>
  </div>

  <div id="searchArea" class="w3-container w3-amber w3-padding-16 myLink">
    <div class="w3-third w3-padding">
      <select id="myselect" class="w3-select">
        <option value="">Department:</option>
        <option value='mathcs'>Math / Computer Science</option>
        <option value='music'>Music</option>
        <option value='physics'>Physics</option>
        <option value='anthro'>Anthropology</option>
        <option value='psych'>Psychology</option>
      </select>
    </div>

    <div class="w3-third w3-padding">
      <input id="profSearch" type="text" class="w3-input w3-border" placeholder="Who's your prof?">
    </div>
    <div class="w3-third w3-padding">
      <input type="button" class="w3-button w3-gray" id="goButton" name="goButton" value="Find My Prof?" onclick="search_time(); toggle_visibility('classSearch');">
    </div>
  </div>

  <div id="classSearch" class="w3-myLink w3-center">
    <a href="#" class="w3-text-white">Click here to search by class instead</a>
  </div>

  <div class="w3-container w3-center w3-padding">
    <p id="demo" class="w3-center"></p>
  </div>

  <footer class="w3-container w3-center w3-opacity w3-margin-bottom">
    <h5><a href="#" class="w3-hover-text-amber">Full directory</a></h5>
    <h5><a href="3" class="w3-hover-text-amber">Support</a></h5>
    <p>Powered by <a href="https://www.w3schools.com/w3css/default.asp" target="_blank" class="w3-hover-text-amber w3-text-white">w3.css</a></p>
  </footer>


  <script>
    /** Not going to lie, this is a pretty hacky implementation, but it works. A better implementation would probably use JQuery. */
    function readJsonFile(file, callback) {
      var rawFile = new XMLHttpRequest();
      rawFile.responseType = 'json'
      rawFile.overrideMimeType("application/json");
      rawFile.open("GET", file, true);
      rawFile.onreadystatechange = function() {
        if (rawFile.readyState === 4 && rawFile.status == "200") {
          callback(rawFile.response);
        }
      }
      rawFile.send(null);
    }

    function search_time() {
      var data, sel, txt, name = "";
      if (document.getElementById("profSearch").value) {
        data = window.jsondata;
        sel = document.getElementById("myselect").value;
        txt += "<table class=\"w3-table\">";
        for (x in data.department[sel]) {
          name = data.department[sel][x].name;
          if (name.includes(document.getElementById("profSearch").value)) {
            txt += "<tr><td>" + data.department[sel][x].name + "</td>";
            txt += "<td>" + data.department[sel][x].email + "</td>";
            txt += "<td>" + data.department[sel][x].phone + "</td>";
            txt += "<td>" + data.department[sel][x].office.building + ' ' + data.department[sel][x].office.room + "</td></tr>";
          }
        }
        txt += "</table>";
        document.getElementById("demo").innerHTML = txt;

      } else {
        change_myselect();
      }
    }

    function change_myselect() {
      var data, x, txt = "";
      sel = document.getElementById("myselect").value;
      data = window.jsondata;
      depts = Object.keys(data.department);
      txt += "<table class=\"w3-table\">";
      if (sel === "") {
        for (const y of depts) {
          for (x in data.department[y]) {
            txt += "<tr><td>" + y.toUpperCase() + "</td>";
            txt += "<td>" + data.department[y][x].name + "</td>";
            txt += "<td>" + data.department[y][x].email + "</td>";
            txt += "<td>" + data.department[y][x].phone + "</td>";
            txt += "<td>" + data.department[y][x].office.building + ' ' + data.department[y][x].office.room + "</td></tr>";
          }
        }
      } else {
        for (x in data.department[sel]) {
          txt += "<tr><td>" + data.department[sel][x].name + "</td>";
          txt += "<td>" + data.department[sel][x].email + "</td>";
          txt += "<td>" + data.department[sel][x].phone + "</td>";
          txt += "<td>" + data.department[sel][x].office.building + ' ' + data.department[sel][x].office.room + "</td></tr>";
        }
      }
      txt += "</table>";
      document.getElementById("demo").innerHTML = txt;
    }

    readJsonFile("./professors.json", function(data) {
      window.jsondata = data;
      console.log(data);
    });

    function toggle_visibility(id) {
      var e = document.getElementById(id);
      e.style.display = 'none';
    }
  </script>

</body>

</html>
